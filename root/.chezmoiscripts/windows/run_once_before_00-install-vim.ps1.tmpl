{{ if eq .osId "windows"}}

$ErrorActionPreference = "Stop"

Write-Host "Ensuring Vim is installed..."

# Check if vim is already installed
if (Get-Command vim -ErrorAction SilentlyContinue) {
    Write-Host "Vim is already installed."
    vim --version | Select-Object -First 1
} else {
    Write-Host "Installing Vim using winget..."
    winget install --id vim.vim --accept-package-agreements --accept-source-agreements

    # Add vim to PATH
    [System.Environment]::SetEnvironmentVariable("Path", $env:Path + ";C:\Program Files\Vim\vim91", "User")
    
    # Refresh environment path to make vim available
    $env:Path = [System.Environment]::GetEnvironmentVariable("Path","Machine") + ";" + [System.Environment]::GetEnvironmentVariable("Path","User")
    
    Write-Host "Vim installation completed."
}

{{ end }}